<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>paircoded</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1e1e1e;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #d4d4d4;
    }
    .container {
      text-align: center;
      padding: 40px;
      background: #2d2d2d;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      min-width: 400px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .subtitle {
      color: #888;
      margin-bottom: 32px;
      font-size: 14px;
    }
    .user-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 24px;
      padding: 12px;
      background: #383838;
      border-radius: 6px;
    }
    .user-info img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }
    .user-info span {
      font-weight: 500;
    }
    .user-info a {
      color: #888;
      font-size: 12px;
      text-decoration: none;
      margin-left: auto;
    }
    .user-info a:hover {
      color: #d4d4d4;
    }
    .form-group {
      margin-bottom: 16px;
      text-align: left;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      color: #888;
    }
    input {
      width: 100%;
      padding: 10px 12px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 4px;
      color: #d4d4d4;
      font-size: 14px;
      font-family: monospace;
    }
    input:focus {
      outline: none;
      border-color: #238636;
    }
    input::placeholder {
      color: #666;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 12px 24px;
      background: #238636;
      color: white;
      text-decoration: none;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #2ea043;
    }
    .btn svg {
      width: 20px;
      height: 20px;
    }
    .divider {
      margin: 24px 0;
      border-top: 1px solid #444;
    }
    .hint {
      margin-top: 16px;
      font-size: 12px;
      color: #666;
    }
    .hint code {
      background: #1e1e1e;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }

    /* Login state */
    #login-section { display: none; }
    #app-section { display: none; }
    body.logged-out #login-section { display: block; }
    body.logged-in #app-section { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <h1>paircoded</h1>
    <p class="subtitle">Share terminals for pair programming</p>

    <!-- Login Section -->
    <div id="login-section">
      <a class="btn" href="/auth/github">
        <svg viewBox="0 0 16 16" fill="currentColor">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        Sign in with GitHub
      </a>
    </div>

    <!-- App Section (after login) -->
    <div id="app-section">
      <div class="user-info" id="user-info"></div>

      <form id="session-form">
        <div class="form-group">
          <label for="left-session">Left terminal (your session)</label>
          <input type="text" id="left-session" placeholder="curious-purple-panda" required>
        </div>
        <div class="form-group">
          <label for="right-session">Right terminal (pair's session)</label>
          <input type="text" id="right-session" placeholder="fancy-blue-elephant" required>
        </div>
        <button type="submit" class="btn">Connect</button>
      </form>

      <p class="hint">
        Get session names from <code>paircoded localhost:8080</code>
      </p>
    </div>
  </div>

  <script>
    // Check auth status
    fetch('/auth/status')
      .then(res => res.json())
      .then(data => {
        if (data.authenticated && data.user) {
          document.body.classList.add('logged-in');
          document.getElementById('user-info').innerHTML = `
            <img src="${data.user.avatar_url}" alt="${data.user.login}">
            <span>${data.user.login}</span>
            <a href="#" onclick="logout(); return false;">logout</a>
          `;
        } else {
          document.body.classList.add('logged-out');
        }
      })
      .catch(() => {
        document.body.classList.add('logged-out');
      });

    function logout() {
      fetch('/auth/logout', { method: 'POST' })
        .then(() => window.location.reload())
        .catch(() => {});
    }

    // Handle form submission
    document.getElementById('session-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const left = document.getElementById('left-session').value.trim();
      const right = document.getElementById('right-session').value.trim();
      if (left && right) {
        window.location.href = `/terminal/${left}/${right}`;
      }
    });
  </script>
</body>
</html>
